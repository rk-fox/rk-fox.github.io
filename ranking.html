<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking da Comunidade</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
 
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
 
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
 
        th {
            background-color: #f2f2f2;
        }
 
        img {
            width: 48px;
            height: 48px;
        }
    </style>
</head>
<body>
    <h1>Ranking de Poder dos Usuários</h1>
    <table id="rankingTable">
        <thead>
            <tr>
                <th>Avatar</th>
                <th>Nome do Personagem</th>
                <th>Miners</th>
                <th>Bônus (%)</th>
                <th>Bônus</th>
                <th>Racks</th>
                <th>Total (Poder)</th>
            </tr>
        </thead>
        <tbody>
            <!-- Os dados serão inseridos aqui -->
        </tbody>
    </table>
 
    <script>
        // Array de objetos com IDs de usuários e nomes de personagens
        const users = [
            { id: '61e852b4dc27dc001969efa3', name: 'RKFox' },
            { id: '61e484ca5aa1be001868f065', name: 'HANTAROGAMER' },
            { id: '65de9e82a1e9f41193e2f6cc', name: 'GUERDE' }
        ];
 
        // Função para converter o poder para a unidade apropriada
        function convertPower(power) {
            if (power >= 1e9) {
                return (power / 1e9).toFixed(2) + ' EH';
            } else if (power >= 1e6) {
                return (power / 1e6).toFixed(2) + ' PH';
            } else {
                return power.toFixed(2) + ' TH';
            }
        }
 
        // Função para buscar dados do usuário
        async function fetchUserData(userId) {
            const baseUrl = "https://rollercoin.com/api/profile/user-power-data/";
            const url = `${baseUrl}${userId}`;
            const encodedUrl = encodeURIComponent(url);
 
            try {
                const response = await fetch(`https://rollercoin.free.mockoapp.net/get?url=${encodedUrl}`);
 
                if (!response.ok) {
                    throw new Error('Erro na requisição: ' + response.statusText);
                }
 
                const responseData = await response.json();
                const data = JSON.parse(responseData.contents).data; // Parseia a string JSON dos dados
                return data;
            } catch (error) {
                console.error('Erro ao buscar dados do usuário:', error);
                return null;
            }
        }
 
        // Função para adicionar dados à tabela
        function addDataToTable(user, userData) {
            const tableBody = document.querySelector('#rankingTable tbody');
            const row = document.createElement('tr');
 
            const avatarUrl = `https://avatars.rollercoin.com/static/avatars/thumbnails/48/${user.id}.png?v=1652150400524`;
 
            row.innerHTML = `
                <td><img src="${avatarUrl}" alt="Avatar de ${user.name}"></td>
                <td>${user.name}</td>
                <td>${userData.miners}</td>
                <td>${userData.bonus_percent.toFixed(2)}</td>
                <td>${userData.bonus.toFixed(2)}</td>
                <td>${userData.racks}</td>
                <td>${convertPower(userData.total)}</td>
            `;
 
            tableBody.appendChild(row);
        }
 
        // Função para buscar e exibir os dados de todos os usuários
        async function fetchAndDisplayAllUsers() {
            for (const user of users) {
                const userData = await fetchUserData(user.id);
                if (userData) {
                    addDataToTable(user, userData);
                }
            }
        }
 
        // Inicia a busca e exibição dos dados ao carregar a página
        window.onload = fetchAndDisplayAllUsers;
    </script>
</body>
</html>
